<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Semana 14 - Reportes y Analytics</title>
  <link rel="stylesheet" href="../assets/style1.css" />
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <script defer src="../assets/interacciones.js"></script>
  <style>
    /* MISMOS ESTILOS DE SEMANAS ANTERIORES */
    nav.navbar {
      background-color: #1e293b;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
    }

    .navbar-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .navbar-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-link {
      display: flex;
      align-items: center;
    }

    .logo {
      height: 40px;
      width: auto;
      filter: drop-shadow(0 0 3px #00ffc3);
      transition: filter 0.3s ease;
    }

    .logo-link:hover .logo {
      filter: drop-shadow(0 0 6px #00cfa3);
    }

    .nombre-desarrollador-nav {
      color: #00ffc3;
      font-weight: bold;
      font-size: 1.1rem;
      padding: 8px 16px;
      border-radius: 5px;
      background: rgba(0, 255, 195, 0.1);
      border: 1px solid #00ffc3;
    }

    .navbar a {
      color: #fff;
      text-decoration: none;
      font-weight: bold;
      padding: 8px 16px;
      border-radius: 5px;
      transition: background 0.3s ease, transform 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .navbar a:hover {
      background-color: #3b82f6;
      transform: scale(1.05);
    }

    .navbar a.clicked {
      background-color: #3b82f6;
    }

    /* Contenedor principal */
    .container {
      margin-top: 80px;
      padding: 20px;
      max-width: 1200px;
    }

    /* Encabezado */
    .encabezado-semana {
      text-align: center;
      margin-bottom: 40px;
      padding: 30px;
      background: rgba(30, 41, 59, 0.9);
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0, 255, 195, 0.2);
      border: 1px solid #334155;
    }

    .encabezado-semana h1 {
      color: #00ffc3;
      font-size: 2.5rem;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .encabezado-semana p {
      color: #cbd5e1;
      font-size: 1.2rem;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.6;
    }

    /* Grid de contenido */
    .grid-contenido {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
      gap: 30px;
      margin: 40px 0;
    }

    /* Tarjetas de temas */
    .tarjeta-tema {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 8px 25px rgba(0, 255, 195, 0.2);
      border: 1px solid #334155;
      transition: transform 0.3s ease;
    }

    .tarjeta-tema:hover {
      transform: translateY(-5px);
    }

    .tarjeta-tema h2 {
      color: #00ffc3;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 1.8rem;
    }

    .tarjeta-tema p {
      color: #cbd5e1;
      line-height: 1.6;
      margin-bottom: 20px;
    }

    /* Acordeones mejorados */
    .acordeon {
      background: linear-gradient(135deg, #00ffc3, #00cfa3);
      color: #000;
      cursor: pointer;
      padding: 18px 20px;
      width: 100%;
      border: none;
      text-align: left;
      outline: none;
      font-size: 1.1rem;
      font-weight: bold;
      border-radius: 10px;
      margin: 15px 0;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .acordeon:hover {
      background: linear-gradient(135deg, #00cfa3, #00b393);
      transform: translateY(-2px);
    }

    .acordeon::after {
      content: "‚ñ∂";
      transition: transform 0.3s ease;
    }

    .acordeon.active::after {
      transform: rotate(90deg);
    }

    .panel {
      background: rgba(255, 255, 255, 0.05);
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.4s ease;
      padding: 0 20px;
      border-radius: 0 0 10px 10px;
    }

    .panel.active {
      padding: 20px;
    }

    .panel ul {
      color: #cbd5e1;
      padding-left: 20px;
      margin: 15px 0;
    }

    .panel li {
      margin: 8px 0;
      line-height: 1.5;
    }

    /* C√≥digos resumidos */
    .codigo-resumido {
      background: #111;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      border-left: 4px solid #00ffc3;
    }

    .codigo-resumido pre {
      color: #0ff;
      margin: 0;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .codigo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .codigo-header h4 {
      color: #00ffc3;
      margin: 0;
    }

    /* Botones mejorados */
    .botones-accion {
      display: flex;
      gap: 15px;
      margin: 25px 0;
      flex-wrap: wrap;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 14px 26px;
      background: rgba(0, 255, 195, 0.15);
      color: #00ffc3;
      text-decoration: none;
      border-radius: 10px;
      border: 2px solid #00ffc3;
      transition: all 0.3s ease;
      font-weight: bold;
      font-size: 1rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 255, 195, 0.3);
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:hover {
      background: #00ffc3;
      color: #000;
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 255, 195, 0.6);
    }

    .btn:active {
      transform: translateY(-2px);
    }

    .btn.solucion {
      background: rgba(147, 51, 234, 0.15);
      border-color: #9333ea;
      color: #9333ea;
      box-shadow: 0 4px 15px rgba(147, 51, 234, 0.3);
    }

    .btn.solucion:hover {
      background: #9333ea;
      color: #fff;
      box-shadow: 0 8px 25px rgba(147, 51, 234, 0.6);
    }

    .btn.regresar {
      background: rgba(107, 114, 128, 0.15);
      border-color: #6b7280;
      color: #6b7280;
      margin: 30px auto;
      display: flex;
      justify-content: center;
      max-width: 200px;
      box-shadow: 0 4px 15px rgba(107, 114, 128, 0.3);
    }

    .btn.regresar:hover {
      background: #6b7280;
      color: #fff;
      box-shadow: 0 8px 25px rgba(107, 114, 128, 0.6);
    }

    /* Grid de resumen */
    .resumen-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin: 40px 0;
    }

    .tarjeta-resumen {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      border: 1px solid #334155;
      transition: all 0.3s ease;
      box-shadow: 0 5px 20px rgba(0, 255, 195, 0.1);
    }

    .tarjeta-resumen:hover {
      transform: translateY(-5px);
      border-color: #00ffc3;
      box-shadow: 0 8px 25px rgba(0, 255, 195, 0.2);
    }

    .tarjeta-resumen .icono {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: #00ffc3;
    }

    .tarjeta-resumen h4 {
      color: #00ffc3;
      margin: 0 0 10px 0;
      font-size: 1.2rem;
    }

    .tarjeta-resumen p {
      color: #cbd5e1;
      margin: 0;
      line-height: 1.5;
    }

    /* Dashboard de Reportes */
    .reportes-dashboard {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 15px;
      padding: 30px;
      margin: 30px 0;
      border: 1px solid #334155;
    }

    .reportes-dashboard h3 {
      color: #00ffc3;
      text-align: center;
      margin-bottom: 30px;
    }

    .metricas-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }

    .metrica-card {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      border: 1px solid #334155;
      transition: all 0.3s ease;
    }

    .metrica-card:hover {
      border-color: #00ffc3;
      transform: translateY(-5px);
    }

    .metrica-valor {
      font-size: 2.5rem;
      font-weight: bold;
      color: #00ffc3;
      margin: 10px 0;
    }

    .metrica-label {
      color: #cbd5e1;
      font-size: 0.9rem;
    }

    /* Gr√°ficos Simulados */
    .graficos-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 30px 0;
    }

    .grafico-card {
      background: rgba(30, 41, 59, 0.9);
      border-radius: 10px;
      padding: 20px;
      border: 1px solid #334155;
    }

    .grafico-card h4 {
      color: #00ffc3;
      margin-bottom: 15px;
      text-align: center;
    }

    .grafico-simulado {
      height: 200px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 8px;
      display: flex;
      align-items: flex-end;
      padding: 10px;
      gap: 5px;
    }

    .barra {
      flex: 1;
      background: linear-gradient(to top, #00ffc3, #00cfa3);
      border-radius: 4px 4px 0 0;
      min-height: 10px;
      transition: height 0.3s ease;
      position: relative;
    }

    .barra:hover {
      opacity: 0.8;
    }

    .barra::after {
      content: attr(data-value);
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      color: #00ffc3;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    /* Tablas de Reportes */
    .tabla-reportes-container {
      overflow-x: auto;
      margin: 20px 0;
      border-radius: 8px;
      background: rgba(30, 41, 59, 0.8);
    }

    .tabla-reportes {
      width: 100%;
      border-collapse: collapse;
      min-width: 800px;
    }

    .tabla-reportes th {
      background: #00ffc3;
      color: #000;
      padding: 15px;
      text-align: left;
      font-weight: bold;
      position: sticky;
      top: 0;
    }

    .tabla-reportes td {
      padding: 12px 15px;
      border-bottom: 1px solid #334155;
      color: #cbd5e1;
    }

    .tabla-reportes tr:hover {
      background: rgba(0, 255, 195, 0.05);
    }

    .badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: bold;
    }

    .badge.aprobado {
      background: rgba(34, 197, 94, 0.2);
      color: #22c55e;
      border: 1px solid #22c55e;
    }

    .badge.pendiente {
      background: rgba(234, 179, 8, 0.2);
      color: #eab308;
      border: 1px solid #eab308;
    }

    .badge.rechazado {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      border: 1px solid #ef4444;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .grid-contenido {
        grid-template-columns: 1fr;
      }
      
      .resumen-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
      
      .botones-accion {
        flex-direction: column;
      }
      
      .btn {
        justify-content: center;
      }

      .metricas-grid {
        grid-template-columns: repeat(2, 1fr);
      }

      .graficos-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .metricas-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-left">
      <a href="../interfaz.html" class="logo-link" aria-label="Inicio">
        <img src="../IMG/UPLA.png" alt="Logo Universidad" class="logo" />
      </a>
      <div class="nombre-desarrollador-nav">
        <i class="fas fa-user"></i> Jhon Huaman Cardenas
      </div>
    </div>

    <div class="navbar-right">
      <a href="../interfaz.html"><i class="fas fa-home"></i> Inicio</a>
      <a href="../sobre-mi.html"><i class="fas fa-user"></i> Sobre m√≠</a>
      <a href="../tareas.html" class="clicked"><i class="fas fa-tasks"></i> Tareas</a>
    </div>
  </nav>

  <canvas id="particles"></canvas>

  <main class="container">
    <!-- Encabezado -->
    <section class="encabezado-semana fade-in">
      <h1><i class="fas fa-chart-line"></i> Semana 14 - Reportes y Analytics</h1>
      <p>Sistema completo de reportes estad√≠sticos, m√©tricas y an√°lisis de datos para seguimiento acad√©mico.</p>
    </section>

    <!-- Grid de resumen -->
    <div class="resumen-grid fade-in">
      <div class="tarjeta-resumen">
        <div class="icono">üìà</div>
        <h4>Dashboard Admin</h4>
        <p>M√©tricas en tiempo real del sistema</p>
      </div>
      <div class="tarjeta-resumen">
        <div class="icono">üìä</div>
        <h4>Reportes Tesis</h4>
        <p>Estad√≠sticas de evaluaci√≥n por departamento</p>
      </div>
      <div class="tarjeta-resumen">
        <div class="icono">üë•</div>
        <h4>Analytics Usuarios</h4>
        <p>Comportamiento y actividad de usuarios</p>
      </div>
      <div class="tarjeta-resumen">
        <div class="icono">üìã</div>
        <h4>Exportaci√≥n PDF</h4>
        <p>Generaci√≥n de reportes imprimibles</p>
      </div>
    </div>

    <!-- Dashboard de M√©tricas -->
    <div class="reportes-dashboard fade-in">
      <h3><i class="fas fa-tachometer-alt"></i> Dashboard de M√©tricas - Vista Administrador</h3>
      <div class="metricas-grid">
        <div class="metrica-card">
          <div class="metrica-valor">142</div>
          <div class="metrica-label">Total Usuarios</div>
        </div>
        <div class="metrica-card">
          <div class="metrica-valor">67</div>
          <div class="metrica-label">Tesis Activas</div>
        </div>
        <div class="metrica-card">
          <div class="metrica-valor">38</div>
          <div class="metrica-label">En Evaluaci√≥n</div>
        </div>
        <div class="metrica-card">
          <div class="metrica-valor">89%</div>
          <div class="metrica-label">Tasa de Aprobaci√≥n</div>
        </div>
      </div>
    </div>

    <!-- Grid de contenido -->
    <div class="grid-contenido">
      <!-- Tarjeta Reportes Administrativos -->
      <section class="tarjeta-tema fade-in">
        <h2><i class="fas fa-chart-bar"></i> 1. Reportes Administrativos</h2>
        <p>M√©tricas y estad√≠sticas para la toma de decisiones acad√©micas y administrativas.</p>

        <button class="acordeon">
          <i class="fas fa-university"></i> Reportes por Departamento
        </button>
        <div class="panel">
          <h4>Estad√≠sticas por Facultad/Departamento</h4>
          
          <div class="graficos-container">
            <div class="grafico-card">
              <h4>Tesis por Departamento</h4>
              <div class="grafico-simulado">
                <div class="barra" style="height: 85%" data-value="25"></div>
                <div class="barra" style="height: 70%" data-value="18"></div>
                <div class="barra" style="height: 60%" data-value="15"></div>
                <div class="barra" style="height: 45%" data-value="9"></div>
              </div>
              <div style="display: flex; justify-content: space-between; margin-top: 10px;">
                <span style="color: #cbd5e1; font-size: 0.8rem;">Ing. Civil</span>
                <span style="color: #cbd5e1; font-size: 0.8rem;">Medicina</span>
                <span style="color: #cbd5e1; font-size: 0.8rem;">Derecho</span>
                <span style="color: #cbd5e1; font-size: 0.8rem;">Educaci√≥n</span>
              </div>
            </div>
            
            <div class="grafico-card">
              <h4>Tasa de Aprobaci√≥n</h4>
              <div class="grafico-simulado">
                <div class="barra" style="height: 95%" data-value="95%"></div>
                <div class="barra" style="height: 82%" data-value="82%"></div>
                <div class="barra" style="height: 75%" data-value="75%"></div>
                <div class="barra" style="height: 88%" data-value="88%"></div>
              </div>
            </div>
          </div>

          <div class="tabla-reportes-container">
            <table class="tabla-reportes">
              <thead>
                <tr>
                  <th>Departamento</th>
                  <th>Tesis Totales</th>
                  <th>En Evaluaci√≥n</th>
                  <th>Aprobadas</th>
                  <th>Tasa Aprobaci√≥n</th>
                  <th>Promedio Calificaci√≥n</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Ingenier√≠a Civil</td>
                  <td>25</td>
                  <td>8</td>
                  <td>15</td>
                  <td>85%</td>
                  <td>16.8</td>
                </tr>
                <tr>
                  <td>Medicina Humana</td>
                  <td>18</td>
                  <td>5</td>
                  <td>12</td>
                  <td>82%</td>
                  <td>17.2</td>
                </tr>
                <tr>
                  <td>Derecho</td>
                  <td>15</td>
                  <td>4</td>
                  <td>9</td>
                  <td>75%</td>
                  <td>15.5</td>
                </tr>
                <tr>
                  <td>Educaci√≥n</td>
                  <td>9</td>
                  <td>2</td>
                  <td>6</td>
                  <td>88%</td>
                  <td>16.9</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Tarjeta Reportes de Evaluaci√≥n -->
      <section class="tarjeta-tema fade-in">
        <h2><i class="fas fa-clipboard-check"></i> 2. Reportes de Evaluaci√≥n</h2>
        <p>An√°lisis detallado del desempe√±o en los 38 criterios de evaluaci√≥n.</p>

        <button class="acordeon">
          <i class="fas fa-chart-pie"></i> An√°lisis por Criterio
        </button>
        <div class="panel">
          <h4>Desempe√±o en los 38 Criterios</h4>
          
          <div class="tabla-reportes-container">
            <table class="tabla-reportes">
              <thead>
                <tr>
                  <th>Criterio</th>
                  <th>Secci√≥n</th>
                  <th>Promedio</th>
                  <th>Desviaci√≥n</th>
                  <th>Fortaleza</th>
                  <th>Debilidad</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>#1 T√≠tulo</td>
                  <td>T√çTULO</td>
                  <td>0.95</td>
                  <td>0.12</td>
                  <td><span class="badge aprobado">Alta</span></td>
                  <td>Baja</td>
                </tr>
                <tr>
                  <td>#2-3 Resumen</td>
                  <td>RESUMEN</td>
                  <td>1.85</td>
                  <td>0.25</td>
                  <td><span class="badge aprobado">Media</span></td>
                  <td>Media</td>
                </tr>
                <tr>
                  <td>#4-11 Introducci√≥n</td>
                  <td>INTRODUCCI√ìN</td>
                  <td>7.2</td>
                  <td>0.85</td>
                  <td><span class="badge aprobado">Alta</span></td>
                  <td>Baja</td>
                </tr>
                <tr>
                  <td>#20-28 Metodolog√≠a</td>
                  <td>METODOLOG√çA</td>
                  <td>8.1</td>
                  <td>1.15</td>
                  <td><span class="badge aprobado">Alta</span></td>
                  <td>Media</td>
                </tr>
                <tr>
                  <td>#35-38 Formato</td>
                  <td>FORMATO</td>
                  <td>3.4</td>
                  <td>0.45</td>
                  <td><span class="badge pendiente">Media</span></td>
                  <td><span class="badge rechazado">Alta</span></td>
                </tr>
              </tbody>
            </table>
          </div>

          <h4>Insights del An√°lisis</h4>
          <ul>
            <li><strong>Fortalezas:</strong> T√≠tulos claros, metodolog√≠a bien estructurada</li>
            <li><strong>Debilidades:</strong> Formato APA y aspectos formales</li>
            <li><strong>Oportunidades:</strong> Capacitaci√≥n en redacci√≥n acad√©mica</li>
            <li><strong>Amenazas:</strong> Consistencia en evaluaciones</li>
          </ul>
        </div>
      </section>
    </div>

    <!-- Reportes de Usuarios -->
    <section class="tarjeta-tema fade-in">
      <h2><i class="fas fa-users"></i> 3. Reportes de Usuarios</h2>
      <p>An√°lisis de actividad, desempe√±o y comportamiento de los usuarios del sistema.</p>

      <button class="acordeon">
        <i class="fas fa-user-clock"></i> Actividad de Usuarios
      </button>
      <div class="panel">
        <h4>M√©tricas de Actividad y Desempe√±o</h4>
        
        <div class="metricas-grid" style="margin: 20px 0;">
          <div class="metrica-card">
            <div class="metrica-valor">142</div>
            <div class="metrica-label">Usuarios Activos</div>
          </div>
          <div class="metrica-card">
            <div class="metrica-valor">87%</div>
            <div class="metrica-label">Tasa de Actividad</div>
          </div>
          <div class="metrica-card">
            <div class="metrica-valor">4.2</div>
            <div class="metrica-label">Sesiones/D√≠a</div>
          </div>
          <div class="metrica-card">
            <div class="metrica-valor">12.5m</div>
            <div class="metrica-label">Tiempo Promedio</div>
          </div>
        </div>

        <div class="tabla-reportes-container">
          <table class="tabla-reportes">
            <thead>
              <tr>
                <th>Rol</th>
                <th>Cantidad</th>
                <th>Actividad Semanal</th>
                <th>Tesis Asignadas</th>
                <th>Evaluaciones Completadas</th>
                <th>Promedio Tiempo Respuesta</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Estudiantes</td>
                <td>85</td>
                <td>Alta</td>
                <td>1.2</td>
                <td>-</td>
                <td>-</td>
              </tr>
              <tr>
                <td>Asesores</td>
                <td>32</td>
                <td>Media</td>
                <td>4.8</td>
                <td>-</td>
                <td>3.2 d√≠as</td>
              </tr>
              <tr>
                <td>Jurados</td>
                <td>24</td>
                <td>Media</td>
                <td>6.5</td>
                <td>4.1</td>
                <td>5.8 d√≠as</td>
              </tr>
              <tr>
                <td>Administradores</td>
                <td>1</td>
                <td>Alta</td>
                <td>-</td>
                <td>-</td>
                <td>-</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Exportaci√≥n de Reportes -->
    <section class="tarjeta-tema fade-in">
      <h2><i class="fas fa-file-export"></i> 4. Exportaci√≥n de Reportes</h2>
      <p>Sistema de generaci√≥n y exportaci√≥n de reportes en diferentes formatos.</p>

      <button class="acordeon">
        <i class="fas fa-file-pdf"></i> Generaci√≥n de PDF
      </button>
      <div class="panel">
        <h4>Implementaci√≥n con iText PDF</h4>
        
        <div class="codigo-resumido">
          <div class="codigo-header">
            <h4><i class="fas fa-file-code"></i> ReporteServlet.java - Generaci√≥n PDF</h4>
          </div>
          <pre><code>package com.zonajava.sistemaevaluaciontesis.controller;

import com.itextpdf.kernel.pdf.PdfDocument;
import com.itextpdf.kernel.pdf.PdfWriter;
import com.itextpdf.layout.Document;
import com.itextpdf.layout.element.Paragraph;
import com.itextpdf.layout.element.Table;
import com.itextpdf.layout.property.TextAlignment;
import com.zonajava.sistemaevaluaciontesis.dao.ReporteDAO;
import java.io.IOException;
import jakarta.servlet.ServletException;
import jakarta.servlet.annotation.WebServlet;
import jakarta.servlet.http.HttpServlet;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;

@WebServlet("/reportes/pdf")
public class ReporteServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response)
            throws ServletException, IOException {
        
        response.setContentType("application/pdf");
        response.setHeader("Content-Disposition", 
                          "attachment; filename=\"reporte_tesis.pdf\"");
        
        try {
            PdfWriter writer = new PdfWriter(response.getOutputStream());
            PdfDocument pdf = new PdfDocument(writer);
            Document document = new Document(pdf);
            
            // T√≠tulo del reporte
            Paragraph titulo = new Paragraph("Reporte de Evaluaci√≥n de Tesis")
                .setTextAlignment(TextAlignment.CENTER)
                .setFontSize(18);
            document.add(titulo);
            
            // Subt√≠tulo
            Paragraph subtitulo = new Paragraph("Universidad Peruana Los Andes")
                .setTextAlignment(TextAlignment.CENTER)
                .setFontSize(12);
            document.add(subtitulo);
            
            document.add(new Paragraph("\n"));
            
            // Crear tabla con datos
            Table tabla = new Table(5);
            tabla.addHeaderCell("Departamento");
            tabla.addHeaderCell("Tesis Totales");
            tabla.addHeaderCell("Aprobadas");
            tabla.addHeaderCell("Rechazadas");
            tabla.addHeaderCell("Tasa Aprobaci√≥n");
            
            // Obtener datos de la base de datos
            ReporteDAO reporteDAO = new ReporteDAO();
            List<Object[]> datos = reporteDAO.obtenerReporteDepartamentos();
            
            for (Object[] fila : datos) {
                tabla.addCell(fila[0].toString());
                tabla.addCell(fila[1].toString());
                tabla.addCell(fila[2].toString());
                tabla.addCell(fila[3].toString());
                tabla.addCell(fila[4].toString() + "%");
            }
            
            document.add(tabla);
            document.close();
            
        } catch (Exception e) {
            response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, 
                              "Error generando PDF: " + e.getMessage());
        }
    }
}</code></pre>
        </div>

        <h4>Formatos de Exportaci√≥n</h4>
        <ul>
          <li><strong>PDF:</strong> Reportes imprimibles con iText</li>
          <li><strong>Excel:</strong> Datos tabulares con Apache POI</li>
          <li><strong>CSV:</strong> Para an√°lisis en herramientas externas</li>
          <li><strong>HTML:</strong> Reportes interactivos en navegador</li>
        </ul>
      </div>

      <button class="acordeon">
        <i class="fas fa-file-excel"></i> Exportaci√≥n a Excel
      </button>
      <div class="panel">
        <h4>Implementaci√≥n con Apache POI</h4>
        
        <div class="codigo-resumido">
          <div class="codigo-header">
            <h4><i class="fas fa-file-code"></i> ExportExcelServlet.java</h4>
          </div>
          <pre><code>@WebServlet("/reportes/excel")
public class ExportExcelServlet extends HttpServlet {
    
    @Override
    protected void doGet(HttpServletRequest request, 
                        HttpServletResponse response)
            throws ServletException, IOException {
        
        response.setContentType("application/vnd.ms-excel");
        response.setHeader("Content-Disposition", 
                          "attachment; filename=\"reporte_evaluaciones.xlsx\"");
        
        try (XSSFWorkbook workbook = new XSSFWorkbook()) {
            XSSFSheet sheet = workbook.createSheet("Evaluaciones");
            
            // Crear encabezados
            Row headerRow = sheet.createRow(0);
            String[] headers = {"ID", "T√≠tulo", "Estudiante", "Jurado", 
                               "Calificaci√≥n", "Estado", "Fecha"};
            
            for (int i = 0; i < headers.length; i++) {
                Cell cell = headerRow.createCell(i);
                cell.setCellValue(headers[i]);
                cell.setCellStyle(createHeaderStyle(workbook));
            }
            
            // Obtener datos y llenar filas
            EvaluacionDAO evaluacionDAO = new EvaluacionDAO();
            List<Evaluacion> evaluaciones = evaluacionDAO.obtenerTodasEvaluaciones();
            
            int rowNum = 1;
            for (Evaluacion evaluacion : evaluaciones) {
                Row row = sheet.createRow(rowNum++);
                row.createCell(0).setCellValue(evaluacion.getIdEvaluacion());
                row.createCell(1).setCellValue(evaluacion.getTituloTesis());
                row.createCell(2).setCellValue(evaluacion.getNombreEstudiante());
                row.createCell(3).setCellValue(evaluacion.getNombreJurado());
                row.createCell(4).setCellValue(evaluacion.getCalificacionFinal());
                row.createCell(5).setCellValue(evaluacion.getEstado());
                row.createCell(6).setCellValue(
                    new SimpleDateFormat("dd/MM/yyyy").format(
                        evaluacion.getFechaEvaluacion()));
            }
            
            // Autoajustar columnas
            for (int i = 0; i < headers.length; i++) {
                sheet.autoSizeColumn(i);
            }
            
            workbook.write(response.getOutputStream());
        }
    }
}</code></pre>
        </div>
      </div>
    </section>

    <!-- Botones de acci√≥n -->
    <div class="botones-accion">
      <a href="https://github.com/JhonFHC/mi-proyecto-web/tree/main/semanas/Semana14" class="btn solucion" target="_blank">
        <i class="fab fa-github"></i> Ver Reportes en GitHub
      </a>
      <a href="../tareas.html" class="btn">
        <i class="fas fa-arrow-left"></i> Volver a Tareas
      </a>
    </div>

    <!-- Bot√≥n de regresar -->
    <a href="../tareas.html" class="btn regresar">
      <i class="fas fa-arrow-left"></i> Volver a Tareas
    </a>
  </main>

  <script>
    // Funcionalidad de acordeones
    document.addEventListener('DOMContentLoaded', function() {
      const acordeones = document.querySelectorAll('.acordeon');

      acordeones.forEach((btn) => {
        btn.addEventListener('click', function () {
          this.classList.toggle('active');
          const panel = this.nextElementSibling;
          
          if (panel.classList.contains('active')) {
            panel.style.maxHeight = null;
            panel.classList.remove('active');
          } else {
            panel.style.maxHeight = panel.scrollHeight + 'px';
            panel.classList.add('active');
          }
        });
      });
    });
  </script>
</body>
</html>